{% extends 'base.html' %}

{% block content %}

<div id="alert">
</div>
<form method="POST" id="myForm">
  {{ form.as_p }}{% csrf_token %}
  <button type="submit" name="send">send</button>
</form>


<script type="text/javascript">
  const form = document.getElementById('myForm')
  const box = document.getElementById('alert')
  const name = document.getElementById('id_name')
  const email = document.getElementById('id_email')
  const content = document.getElementById('id_content')
  const csrf = document.getElementsByName('csrfmiddlewaretoken')
  const url = "{% url 'blog:contact' %}"
  const handelAlert = (type, text) =>{
    box.innerHTML += `<div class="alert alert-${type}" role="alert">${text}</div>`
  }

  form.addEventListener('submit',(e)=>{
    e.preventDefault()
    console.log("submitted")
    $.ajax({
      type: 'POST',
      url : url,
      data : {
        'csrfmiddlewaretoken' : csrf[0].value,
        'name' : name.value,
        'email' : email.value,
        'content' : content.value,
      },
      success: function(response){
        const sText = `Successfuly saved ${response.name}`
        handelAlert('success',sText)
        name.value = ""
        email.value = ""
        content.value = ""
      },
      error: function(error){
        handelAlert('success', 'Ups ... somthing went wrong')
      }
    })
  })
</script>
{% endblock %}
